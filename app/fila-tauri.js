"use strict";
class FilaTauri extends Fila {
    /** */
    static async use() {
        let path = null;
        try {
            path = globalThis.__TAURI__.path;
        }
        catch (e) {
            console.log("withGlobalTauri is not set");
            return;
        }
        let cwd = "/";
        let tmp = "/";
        try {
            cwd = await path.appDataDir();
            tmp = await path.appCacheDir();
        }
        catch (e) {
            console.error("The Tauri environment doesn't have access to the path APIs");
        }
        Fila.setDefaults(FilaTauri, path?.sep || "", cwd, tmp);
    }
    /** */
    fs = globalThis.__TAURI__.fs;
    /** */
    readText() {
        return this.fs.readTextFile(this.path);
    }
    /** */
    readBinary() {
        return this.fs.readBinaryFile(this.path);
    }
    /** */
    async readDirectory() {
        const fileNames = await this.fs.readDir(this.path);
        const filas = [];
        for (const fileName of fileNames)
            if (fileName.name !== ".DS_Store")
                filas.push(Fila.new(this.path, fileName.name || ""));
        return filas;
    }
    /** */
    async writeText(text, options) {
        try {
            const up = this.up();
            if (!await up.exists())
                await up.writeDirectory();
            await this.fs.writeTextFile(this.path, text, {
                append: options?.append
            });
        }
        catch (e) {
            debugger;
        }
    }
    /** */
    async writeBinary(arrayBuffer) {
        await this.up().writeDirectory();
        await this.fs.writeBinaryFile(this.path, arrayBuffer);
    }
    /** */
    async writeDirectory() {
        this.fs.createDir(this.path, { recursive: true });
    }
    /**
     * Writes a symlink file at the location represented by the specified
     * Fila object, to the location specified by the current Fila object.
     */
    async writeSymlink(at) {
        return null;
    }
    /**
     * Deletes the file or directory that this Fila object represents.
     */
    async delete() {
        if (await this.isDirectory()) {
            return new Promise(async (resolve) => {
                await this.fs.removeDir(this.path, { recursive: true });
                resolve();
            });
        }
        await this.fs.removeFile(this.path);
    }
    /** */
    move(target) {
        return null;
    }
    /** */
    async copy(target) {
        if (await target.isDirectory())
            throw "Copying directories is not implemented.";
        await this.fs.copyFile(this.path, target.path);
    }
    /** */
    watchProtected(recursive, callbackFn) {
        let un = null;
        (async () => {
            un = await FilaTauri.watchInternal(this.path, {}, async (ev) => {
                if (!un)
                    return;
                const payload = ev.payload.payload;
                if (typeof payload !== "string")
                    return;
                const fila = Fila.new(ev.payload.payload);
                if (ev.type === "NoticeWrite" || ev.type === "Write")
                    callbackFn("modify" /* Fila.Event.modify */, fila);
                else if (ev.type === "NoticeRemove" || ev.type === "Remove")
                    callbackFn("delete" /* Fila.Event.delete */, fila);
                else if (ev.type === "Create" || ev.type === "Rename")
                    callbackFn("modify" /* Fila.Event.modify */, fila);
            });
        })();
        return () => {
            // This is hacky... the interface expects a function to be
            // returned rather than a promise that resolves to one,
            // so this waits 100ms to call the un() function if this unwatch
            // function is invoked immediately after calling watch().
            if (un)
                un();
            else
                setTimeout(() => un?.(), 100);
        };
    }
    /** */
    async rename(newName) {
        // Note that the "renameFile" method actually works on directories
        return this.fs.renameFile(this.path, this.up().down(newName).path);
    }
    /** */
    async exists() {
        return this.fs.exists(this.path);
    }
    /** */
    async getSize() {
        return (await this.getMeta()).size;
    }
    /** */
    async getModifiedTicks() {
        return (await this.getMeta()).modifiedAt;
    }
    /** */
    async getCreatedTicks() {
        return (await this.getMeta()).createdAt;
    }
    /** */
    async getAccessedTicks() {
        return (await this.getMeta()).accessedAt;
    }
    /** */
    async isDirectory() {
        return (await this.getMeta()).isDir;
    }
    /** */
    async getMeta() {
        return this._meta || (this._meta = await FilaTauri.getMetadata(this.path));
    }
    _meta = null;
}
(function (FilaTauri) {
    //@ts-ignore
    if (!("__TAURI__" in globalThis))
        return;
    const t = globalThis.__TAURI__;
    const tauri = t.tauri;
    const wind = t.window;
    /** @internal */
    async function unwatch(id) {
        await tauri.invoke('plugin:fs-watch|unwatch', { id });
    }
    FilaTauri.unwatch = unwatch;
    /** @internal */
    async function watchInternal(paths, options, callbackFn) {
        const opts = {
            recursive: false,
            delayMs: 2000,
            ...options,
        };
        let watchPaths;
        if (typeof paths === "string")
            watchPaths = [paths];
        else
            watchPaths = paths;
        const id = window.crypto.getRandomValues(new Uint32Array(1))[0];
        await tauri.invoke("plugin:fs-watch|watch", {
            id,
            paths: watchPaths,
            options: opts,
        });
        const unlisten = await wind.appWindow.listen(`watcher://raw-event/${id}`, event => {
            callbackFn(event);
        });
        return async () => {
            await unwatch(id);
            unlisten();
        };
    }
    FilaTauri.watchInternal = watchInternal;
    /** @internal */
    async function watchImmediate(paths, options, callbackFn) {
        const opts = {
            recursive: false,
            ...options,
            delayMs: null
        };
        const watchPaths = typeof paths === "string" ? [paths] : paths;
        const id = window.crypto.getRandomValues(new Uint32Array(1))[0];
        await tauri.invoke("plugin:fs-watch|watch", {
            id,
            paths: watchPaths,
            options: opts,
        });
        const unlisten = await wind.appWindow.listen(`watcher://raw-event/${id}`, event => {
            callbackFn(event);
        });
        return async () => {
            await unwatch(id);
            unlisten();
        };
    }
    FilaTauri.watchImmediate = watchImmediate;
    /** @internal */
    function getMetadata(path) {
        return tauri.invoke("plugin:fs-extra|metadata", { path });
    }
    FilaTauri.getMetadata = getMetadata;
    typeof module === "object" && Object.assign(module.exports, { FilaTauri });
})(FilaTauri || (FilaTauri = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsYS10YXVyaS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL0ZpbGFUYXVyaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsTUFBTSxTQUFVLFNBQVEsSUFBSTtJQUUzQixNQUFNO0lBQ04sTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHO1FBRWYsSUFBSSxJQUFJLEdBQWlELElBQUksQ0FBQztRQUU5RCxJQUNBO1lBQ0MsSUFBSSxHQUFJLFVBQWtCLENBQUMsU0FBUyxDQUFDLElBQTZDLENBQUM7U0FDbkY7UUFDRCxPQUFPLENBQUMsRUFDUjtZQUNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsNEJBQTRCLENBQUMsQ0FBQztZQUMxQyxPQUFPO1NBQ1A7UUFFRCxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDZCxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFFZCxJQUNBO1lBQ0MsR0FBRyxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzlCLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUMvQjtRQUNELE9BQU8sQ0FBQyxFQUNSO1lBQ0MsT0FBTyxDQUFDLEtBQUssQ0FBQyw0REFBNEQsQ0FBQyxDQUFDO1NBQzVFO1FBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxNQUFNO0lBQ1csRUFBRSxHQUNqQixVQUFrQixDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7SUFFbEMsTUFBTTtJQUNOLFFBQVE7UUFFUCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsTUFBTTtJQUNOLFVBQVU7UUFFVCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLElBQUks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QUU7WUFFakIsTUFBTSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEIsUUFBUSxFQUFFLENBQUM7UUFDWixDQUFDLENBQUM7SUFDSCxDQUFDO0lBaENxQix3QkFBYyxpQkFnQ25DLENBQUE7SUF1Q0QsZ0JBQWdCO0lBQ2hCLFNBQWdCLFdBQVcsQ0FBQyxJQUFZO1FBRXZDLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQywwQkFBMEIsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUhlLHFCQUFXLGNBRzFCLENBQUE7SUFnSEQsT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7QUFDNUUsQ0FBQyxFQW5QUyxTQUFTLEtBQVQsU0FBUyxRQW1QbEIiLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIEZpbGFUYXVyaSBleHRlbmRzIEZpbGFcbntcblx0LyoqICovXG5cdHN0YXRpYyBhc3luYyB1c2UoKVxuXHR7XG5cdFx0bGV0IHBhdGg6IHR5cGVvZiBpbXBvcnQoXCJAdGF1cmktYXBwcy9hcGlcIikucGF0aCB8IG51bGwgPSBudWxsO1xuXHRcdFx0XG5cdFx0dHJ5XG5cdFx0e1xuXHRcdFx0cGF0aCA9IChnbG9iYWxUaGlzIGFzIGFueSkuX19UQVVSSV9fLnBhdGggYXMgdHlwZW9mIGltcG9ydChcIkB0YXVyaS1hcHBzL2FwaVwiKS5wYXRoO1xuXHRcdH1cblx0XHRjYXRjaCAoZSlcblx0XHR7XG5cdFx0XHRjb25zb2xlLmxvZyhcIndpdGhHbG9iYWxUYXVyaSBpcyBub3Qgc2V0XCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRcblx0XHRsZXQgY3dkID0gXCIvXCI7XG5cdFx0bGV0IHRtcCA9IFwiL1wiO1xuXHRcdFxuXHRcdHRyeVxuXHRcdHtcblx0XHRcdGN3ZCA9IGF3YWl0IHBhdGguYXBwRGF0YURpcigpO1xuXHRcdFx0dG1wID0gYXdhaXQgcGF0aC5hcHBDYWNoZURpcigpO1xuXHRcdH1cblx0XHRjYXRjaCAoZSlcblx0XHR7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiVGhlIFRhdXJpIGVudmlyb25tZW50IGRvZXNuJ3QgaGF2ZSBhY2Nlc3MgdG8gdGhlIHBhdGggQVBJc1wiKTtcblx0XHR9XG5cdFx0XG5cdFx0RmlsYS5zZXREZWZhdWx0cyhGaWxhVGF1cmksIHBhdGg/LnNlcCB8fCBcIlwiLCBjd2QsIHRtcCk7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRwcml2YXRlIHJlYWRvbmx5IGZzOiB0eXBlb2YgaW1wb3J0KFwiQHRhdXJpLWFwcHMvYXBpXCIpLmZzID0gXG5cdFx0KGdsb2JhbFRoaXMgYXMgYW55KS5fX1RBVVJJX18uZnM7XG5cdFxuXHQvKiogKi9cblx0cmVhZFRleHQoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuZnMucmVhZFRleHRGaWxlKHRoaXMucGF0aCk7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRyZWFkQmluYXJ5KClcblx0e1xuXHRcdHJldHVybiB0aGlzLmZzLnJlYWRCaW5hcnlGaWxlKHRoaXMucGF0aCk7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRhc3luYyByZWFkRGlyZWN0b3J5KClcblx0e1xuXHRcdGNvbnN0IGZpbGVOYW1lcyA9IGF3YWl0IHRoaXMuZnMucmVhZERpcih0aGlzLnBhdGgpO1xuXHRcdGNvbnN0IGZpbGFzOiBGaWxhW10gPSBbXTtcblx0XHRcblx0XHRmb3IgKGNvbnN0IGZpbGVOYW1lIG9mIGZpbGVOYW1lcylcblx0XHRcdGlmIChmaWxlTmFtZS5uYW1lICE9PSBcIi5EU19TdG9yZVwiKVxuXHRcdFx0XHRmaWxhcy5wdXNoKEZpbGEubmV3KHRoaXMucGF0aCwgZmlsZU5hbWUubmFtZSB8fCBcIlwiKSk7XG5cdFx0XG5cdFx0cmV0dXJuIGZpbGFzO1xuXHR9XG5cdFxuXHQvKiogKi9cblx0YXN5bmMgd3JpdGVUZXh0KHRleHQ6IHN0cmluZywgb3B0aW9ucz86IEZpbGEuSVdyaXRlVGV4dE9wdGlvbnMpXG5cdHtcblx0XHR0cnlcblx0XHR7XG5cdFx0XHRjb25zdCB1cCA9IHRoaXMudXAoKTtcblx0XHRcdGlmICghYXdhaXQgdXAuZXhpc3RzKCkpXG5cdFx0XHRcdGF3YWl0IHVwLndyaXRlRGlyZWN0b3J5KCk7XG5cdFx0XHRcblx0XHRcdGF3YWl0IHRoaXMuZnMud3JpdGVUZXh0RmlsZSh0aGlzLnBhdGgsIHRleHQsIHtcblx0XHRcdFx0YXBwZW5kOiBvcHRpb25zPy5hcHBlbmRcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRjYXRjaCAoZSlcblx0XHR7XG5cdFx0XHRkZWJ1Z2dlcjtcblx0XHR9XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRhc3luYyB3cml0ZUJpbmFyeShhcnJheUJ1ZmZlcjogQXJyYXlCdWZmZXIpXG5cdHtcblx0XHRhd2FpdCB0aGlzLnVwKCkud3JpdGVEaXJlY3RvcnkoKTtcblx0XHRhd2FpdCB0aGlzLmZzLndyaXRlQmluYXJ5RmlsZSh0aGlzLnBhdGgsIGFycmF5QnVmZmVyKTtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIHdyaXRlRGlyZWN0b3J5KClcblx0e1xuXHRcdHRoaXMuZnMuY3JlYXRlRGlyKHRoaXMucGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBXcml0ZXMgYSBzeW1saW5rIGZpbGUgYXQgdGhlIGxvY2F0aW9uIHJlcHJlc2VudGVkIGJ5IHRoZSBzcGVjaWZpZWRcblx0ICogRmlsYSBvYmplY3QsIHRvIHRoZSBsb2NhdGlvbiBzcGVjaWZpZWQgYnkgdGhlIGN1cnJlbnQgRmlsYSBvYmplY3QuXG5cdCAqL1xuXHRhc3luYyB3cml0ZVN5bWxpbmsoYXQ6IEZpbGEpXG5cdHtcblx0XHRyZXR1cm4gbnVsbCBhcyBhbnk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBEZWxldGVzIHRoZSBmaWxlIG9yIGRpcmVjdG9yeSB0aGF0IHRoaXMgRmlsYSBvYmplY3QgcmVwcmVzZW50cy5cblx0ICovXG5cdGFzeW5jIGRlbGV0ZSgpOiBQcm9taXNlPEVycm9yIHwgdm9pZD5cblx0e1xuXHRcdGlmIChhd2FpdCB0aGlzLmlzRGlyZWN0b3J5KCkpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlPEVycm9yIHwgdm9pZD4oYXN5bmMgcmVzb2x2ZSA9PlxuXHRcdFx0e1xuXHRcdFx0XHRhd2FpdCB0aGlzLmZzLnJlbW92ZURpcih0aGlzLnBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuXHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0XG5cdFx0YXdhaXQgdGhpcy5mcy5yZW1vdmVGaWxlKHRoaXMucGF0aCk7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRtb3ZlKHRhcmdldDogRmlsYSlcblx0e1xuXHRcdHJldHVybiBudWxsIGFzIGFueTtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIGNvcHkodGFyZ2V0OiBGaWxhKVxuXHR7XG5cdFx0aWYgKGF3YWl0IHRhcmdldC5pc0RpcmVjdG9yeSgpKVxuXHRcdFx0dGhyb3cgXCJDb3B5aW5nIGRpcmVjdG9yaWVzIGlzIG5vdCBpbXBsZW1lbnRlZC5cIjtcblx0XHRcblx0XHRhd2FpdCB0aGlzLmZzLmNvcHlGaWxlKHRoaXMucGF0aCwgdGFyZ2V0LnBhdGgpO1xuXHR9XG5cdFxuXHQvKiogKi9cblx0cHJvdGVjdGVkIHdhdGNoUHJvdGVjdGVkKFxuXHRcdHJlY3Vyc2l2ZTogYm9vbGVhbixcblx0XHRjYWxsYmFja0ZuOiAoZXZlbnQ6IEZpbGEuRXZlbnQsIGZpbGE6IEZpbGEpID0+IHZvaWQpXG5cdHtcblx0XHRsZXQgdW46IEZ1bmN0aW9uIHwgbnVsbCA9IG51bGw7XG5cdFx0XG5cdFx0KGFzeW5jICgpID0+XG5cdFx0e1xuXHRcdFx0dW4gPSBhd2FpdCBGaWxhVGF1cmkud2F0Y2hJbnRlcm5hbCh0aGlzLnBhdGgsIHt9LCBhc3luYyBldiA9PlxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoIXVuKVxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XG5cdFx0XHRcdGNvbnN0IHBheWxvYWQgPSBldi5wYXlsb2FkLnBheWxvYWQ7XG5cdFx0XHRcdGlmICh0eXBlb2YgcGF5bG9hZCAhPT0gXCJzdHJpbmdcIilcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFxuXHRcdFx0XHRjb25zdCBmaWxhID0gRmlsYS5uZXcoZXYucGF5bG9hZC5wYXlsb2FkKTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmIChldi50eXBlID09PSBcIk5vdGljZVdyaXRlXCIgfHwgZXYudHlwZSA9PT0gXCJXcml0ZVwiKVxuXHRcdFx0XHRcdGNhbGxiYWNrRm4oRmlsYS5FdmVudC5tb2RpZnksIGZpbGEpO1xuXHRcdFx0XHRcblx0XHRcdFx0ZWxzZSBpZiAoZXYudHlwZSA9PT0gXCJOb3RpY2VSZW1vdmVcIiB8fCBldi50eXBlID09PSBcIlJlbW92ZVwiKVxuXHRcdFx0XHRcdGNhbGxiYWNrRm4oRmlsYS5FdmVudC5kZWxldGUsIGZpbGEpO1xuXHRcdFx0XHRcblx0XHRcdFx0ZWxzZSBpZiAoZXYudHlwZSA9PT0gXCJDcmVhdGVcIiB8fCBldi50eXBlID09PSBcIlJlbmFtZVwiKVxuXHRcdFx0XHRcdGNhbGxiYWNrRm4oRmlsYS5FdmVudC5tb2RpZnksIGZpbGEpO1xuXHRcdFx0fSk7XG5cdFx0fSkoKTtcblx0XHRcblx0XHRyZXR1cm4gKCkgPT5cblx0XHR7XG5cdFx0XHQvLyBUaGlzIGlzIGhhY2t5Li4uIHRoZSBpbnRlcmZhY2UgZXhwZWN0cyBhIGZ1bmN0aW9uIHRvIGJlXG5cdFx0XHQvLyByZXR1cm5lZCByYXRoZXIgdGhhbiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBvbmUsXG5cdFx0XHQvLyBzbyB0aGlzIHdhaXRzIDEwMG1zIHRvIGNhbGwgdGhlIHVuKCkgZnVuY3Rpb24gaWYgdGhpcyB1bndhdGNoXG5cdFx0XHQvLyBmdW5jdGlvbiBpcyBpbnZva2VkIGltbWVkaWF0ZWx5IGFmdGVyIGNhbGxpbmcgd2F0Y2goKS5cblx0XHRcdGlmICh1bilcblx0XHRcdFx0dW4oKTtcblx0XHRcdGVsc2Vcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB1bj8uKCksIDEwMCk7XG5cdFx0fTtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIHJlbmFtZShuZXdOYW1lOiBzdHJpbmcpXG5cdHtcblx0XHQvLyBOb3RlIHRoYXQgdGhlIFwicmVuYW1lRmlsZVwiIG1ldGhvZCBhY3R1YWxseSB3b3JrcyBvbiBkaXJlY3Rvcmllc1xuXHRcdHJldHVybiB0aGlzLmZzLnJlbmFtZUZpbGUodGhpcy5wYXRoLCB0aGlzLnVwKCkuZG93bihuZXdOYW1lKS5wYXRoKTtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIGV4aXN0cygpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5mcy5leGlzdHModGhpcy5wYXRoKTtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIGdldFNpemUoKVxuXHR7XG5cdFx0cmV0dXJuIChhd2FpdCB0aGlzLmdldE1ldGEoKSkuc2l6ZTtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIGdldE1vZGlmaWVkVGlja3MoKVxuXHR7XG5cdFx0cmV0dXJuIChhd2FpdCB0aGlzLmdldE1ldGEoKSkubW9kaWZpZWRBdDtcblx0fVxuXHRcblx0LyoqICovXG5cdGFzeW5jIGdldENyZWF0ZWRUaWNrcygpXG5cdHtcblx0XHRyZXR1cm4gKGF3YWl0IHRoaXMuZ2V0TWV0YSgpKS5jcmVhdGVkQXQ7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRhc3luYyBnZXRBY2Nlc3NlZFRpY2tzKClcblx0e1xuXHRcdHJldHVybiAoYXdhaXQgdGhpcy5nZXRNZXRhKCkpLmFjY2Vzc2VkQXQ7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRhc3luYyBpc0RpcmVjdG9yeSgpXG5cdHtcblx0XHRyZXR1cm4gKGF3YWl0IHRoaXMuZ2V0TWV0YSgpKS5pc0Rpcjtcblx0fVxuXHRcblx0LyoqICovXG5cdHByaXZhdGUgYXN5bmMgZ2V0TWV0YSgpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fbWV0YSB8fCAodGhpcy5fbWV0YSA9IGF3YWl0IEZpbGFUYXVyaS5nZXRNZXRhZGF0YSh0aGlzLnBhdGgpKTtcblx0fVxuXHRwcml2YXRlIF9tZXRhOiBGaWxhVGF1cmkuTWV0YWRhdGEgfCBudWxsID0gbnVsbDtcbn1cblxubmFtZXNwYWNlIEZpbGFUYXVyaVxue1xuXHQvL0B0cy1pZ25vcmVcblx0aWYgKCEoXCJfX1RBVVJJX19cIiBpbiBnbG9iYWxUaGlzKSkgcmV0dXJuO1xuXHRcblx0Y29uc3QgdCA9IChnbG9iYWxUaGlzIGFzIGFueSkuX19UQVVSSV9fO1xuXHRjb25zdCB0YXVyaTogdHlwZW9mIGltcG9ydChcIkB0YXVyaS1hcHBzL2FwaVwiKS50YXVyaSA9IHQudGF1cmk7XG5cdGNvbnN0IHdpbmQ6IHR5cGVvZiBpbXBvcnQoXCJAdGF1cmktYXBwcy9hcGlcIikud2luZG93ID0gdC53aW5kb3c7XG5cdFxuXHQvKiogQGludGVybmFsICovXG5cdGV4cG9ydCBhc3luYyBmdW5jdGlvbiB1bndhdGNoKGlkOiBhbnkpXG5cdHtcblx0XHRhd2FpdCB0YXVyaS5pbnZva2UoJ3BsdWdpbjpmcy13YXRjaHx1bndhdGNoJywgeyBpZCB9KTtcblx0fVxuXHRcblx0LyoqIEBpbnRlcm5hbCAqL1xuXHRleHBvcnQgYXN5bmMgZnVuY3Rpb24gd2F0Y2hJbnRlcm5hbChcblx0XHRwYXRoczogc3RyaW5nIHwgc3RyaW5nW10sXG5cdFx0b3B0aW9uczogRGVib3VuY2VkV2F0Y2hPcHRpb25zLFxuXHRcdGNhbGxiYWNrRm46IChldmVudDogVGF1cmlXYXRjaEV2ZW50KSA9PiB2b2lkKTogUHJvbWlzZTwoKSA9PiBQcm9taXNlPHZvaWQ+PlxuXHR7XG5cdFx0Y29uc3Qgb3B0cyA9IHtcblx0XHRcdHJlY3Vyc2l2ZTogZmFsc2UsXG5cdFx0XHRkZWxheU1zOiAyMDAwLFxuXHRcdFx0Li4ub3B0aW9ucyxcblx0XHR9O1xuXHRcdFxuXHRcdGxldCB3YXRjaFBhdGhzO1xuXHRcdGlmICh0eXBlb2YgcGF0aHMgPT09IFwic3RyaW5nXCIpXG5cdFx0XHR3YXRjaFBhdGhzID0gW3BhdGhzXTtcblx0XHRlbHNlXG5cdFx0XHR3YXRjaFBhdGhzID0gcGF0aHM7XG5cdFx0XG5cdFx0Y29uc3QgaWQgPSB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMSkpWzBdO1xuXHRcdGF3YWl0IHRhdXJpLmludm9rZShcInBsdWdpbjpmcy13YXRjaHx3YXRjaFwiLCB7XG5cdFx0XHRpZCxcblx0XHRcdHBhdGhzOiB3YXRjaFBhdGhzLFxuXHRcdFx0b3B0aW9uczogb3B0cyxcblx0XHR9KTtcblx0XHRcblx0XHRjb25zdCB1bmxpc3RlbiA9IGF3YWl0IHdpbmQuYXBwV2luZG93Lmxpc3Rlbihcblx0XHRcdGB3YXRjaGVyOi8vcmF3LWV2ZW50LyR7aWR9YCxcblx0XHRcdGV2ZW50ID0+XG5cdFx0e1xuXHRcdFx0Y2FsbGJhY2tGbihldmVudCBhcyBUYXVyaVdhdGNoRXZlbnQpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBhc3luYyAoKSA9PlxuXHRcdHtcblx0XHRcdGF3YWl0IHVud2F0Y2goaWQpO1xuXHRcdFx0dW5saXN0ZW4oKTtcblx0XHR9O1xuXHR9XG5cdFxuXHQvKiogQGludGVybmFsICovXG5cdGV4cG9ydCBhc3luYyBmdW5jdGlvbiB3YXRjaEltbWVkaWF0ZShcblx0XHRwYXRoczogc3RyaW5nIHwgc3RyaW5nW10sXG5cdFx0b3B0aW9uczogRGVib3VuY2VkV2F0Y2hPcHRpb25zLFxuXHRcdGNhbGxiYWNrRm46IChldmVudDogVGF1cmlXYXRjaEV2ZW50KSA9PiB2b2lkKTogUHJvbWlzZTwoKSA9PiBQcm9taXNlPHZvaWQ+PlxuXHR7XG5cdFx0Y29uc3Qgb3B0cyA9IHtcblx0XHRcdHJlY3Vyc2l2ZTogZmFsc2UsXG5cdFx0XHQuLi5vcHRpb25zLFxuXHRcdFx0ZGVsYXlNczogbnVsbFxuXHRcdH07XG5cdFx0XG5cdFx0Y29uc3Qgd2F0Y2hQYXRocyA9IHR5cGVvZiBwYXRocyA9PT0gXCJzdHJpbmdcIiA/IFtwYXRoc10gOiBwYXRocztcblx0XHRjb25zdCBpZCA9IHdpbmRvdy5jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50MzJBcnJheSgxKSlbMF07XG5cdFx0XG5cdFx0YXdhaXQgdGF1cmkuaW52b2tlKFwicGx1Z2luOmZzLXdhdGNofHdhdGNoXCIsIHtcblx0XHRcdGlkLFxuXHRcdFx0cGF0aHM6IHdhdGNoUGF0aHMsXG5cdFx0XHRvcHRpb25zOiBvcHRzLFxuXHRcdH0pO1xuXHRcdFxuXHRcdGNvbnN0IHVubGlzdGVuID0gYXdhaXQgd2luZC5hcHBXaW5kb3cubGlzdGVuKFxuXHRcdFx0YHdhdGNoZXI6Ly9yYXctZXZlbnQvJHtpZH1gLFxuXHRcdFx0ZXZlbnQgPT5cblx0XHR7XG5cdFx0XHRjYWxsYmFja0ZuKGV2ZW50IGFzIFRhdXJpV2F0Y2hFdmVudCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGFzeW5jICgpID0+XG5cdFx0e1xuXHRcdFx0YXdhaXQgdW53YXRjaChpZCk7XG5cdFx0XHR1bmxpc3RlbigpO1xuXHRcdH07XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRpbnRlcmZhY2UgVGF1cmlXYXRjaEV2ZW50XG5cdHtcblx0XHQvKiogRXhhbXBsZTogXCJ3YXRjaGVyOi8vZGVib3VuY2VkLWV2ZW50LzI5MDMwMzJcIiAqL1xuXHRcdHJlYWRvbmx5IGV2ZW50OiBzdHJpbmc7XG5cdFx0LyoqIEV4YW1wbGU6IFwibWFpblwiICovXG5cdFx0cmVhZG9ubHkgd2luZG93TGFiZWw6IHN0cmluZztcblx0XHQvKiogRXhhbXBsZTogL1VzZXJzL3VzZXIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L2NvbS5hcHAvZmlsZW5hbWUudHh0ICovXG5cdFx0cmVhZG9ubHkgcGF5bG9hZDogeyBwYXlsb2FkOiBzdHJpbmc7IH07XG5cdFx0LyoqICovXG5cdFx0cmVhZG9ubHkgdHlwZTogXG5cdFx0XHRcIk5vdGljZVdyaXRlXCIgfFxuXHRcdFx0XCJOb3RpY2VSZW1vdmVcIiB8XG5cdFx0XHRcIkNyZWF0ZVwiIHxcblx0XHRcdFwiV3JpdGVcIiB8XG5cdFx0XHRcIkNobW9kXCIgfFxuXHRcdFx0XCJSZW1vdmVcIiB8XG5cdFx0XHRcIlJlbmFtZVwiIHxcblx0XHRcdFwiUmVzY2FuXCIgfFxuXHRcdFx0XCJFcnJvclwiO1xuXHRcdFxuXHRcdC8qKiAqL1xuXHRcdHJlYWRvbmx5IGlkOiBudW1iZXI7XG5cdH1cblx0XG5cdC8qKiBAaW50ZXJuYWwgKi9cblx0aW50ZXJmYWNlIFdhdGNoT3B0aW9uc1xuXHR7XG5cdFx0cmVjdXJzaXZlPzogYm9vbGVhbjtcblx0fVxuXHRcblx0LyoqIEBpbnRlcm5hbCAqL1xuXHRpbnRlcmZhY2UgRGVib3VuY2VkV2F0Y2hPcHRpb25zIGV4dGVuZHMgV2F0Y2hPcHRpb25zXG5cdHtcblx0XHRkZWxheU1zPzogbnVtYmVyO1xuXHR9XG5cdFxuXHQvKiogQGludGVybmFsICovXG5cdGV4cG9ydCBmdW5jdGlvbiBnZXRNZXRhZGF0YShwYXRoOiBzdHJpbmcpOiBQcm9taXNlPE1ldGFkYXRhPlxuXHR7XG5cdFx0cmV0dXJuIHRhdXJpLmludm9rZShcInBsdWdpbjpmcy1leHRyYXxtZXRhZGF0YVwiLCB7IHBhdGggfSk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBNZXRhZGF0YSBpbmZvcm1hdGlvbiBhYm91dCBhIGZpbGUuXG5cdCAqIFRoaXMgc3RydWN0dXJlIGlzIHJldHVybmVkIGZyb20gdGhlIGBtZXRhZGF0YWAgZnVuY3Rpb24gb3IgbWV0aG9kXG5cdCAqIGFuZCByZXByZXNlbnRzIGtub3duIG1ldGFkYXRhIGFib3V0IGEgZmlsZSBzdWNoIGFzIGl0cyBwZXJtaXNzaW9ucyxcblx0ICogc2l6ZSwgbW9kaWZpY2F0aW9uIHRpbWVzLCBldGMuXG5cdCAqL1xuXHRleHBvcnQgaW50ZXJmYWNlIE1ldGFkYXRhXG5cdHtcblx0XHQvKipcblx0XHQgKiBUaGUgbGFzdCBhY2Nlc3MgdGltZSBvZiB0aGlzIG1ldGFkYXRhLlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IGFjY2Vzc2VkQXQ6IG51bWJlcjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgY3JlYXRpb24gdGltZSBsaXN0ZWQgaW4gdGhpcyBtZXRhZGF0YS5cblx0XHQgKi9cblx0XHRyZWFkb25seSBjcmVhdGVkQXQ6IG51bWJlcjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgbGFzdCBtb2RpZmljYXRpb24gdGltZSBsaXN0ZWQgaW4gdGhpcyBtZXRhZGF0YS5cblx0XHQgKi9cblx0XHRyZWFkb25seSBtb2RpZmllZEF0OiBudW1iZXI7XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogYHRydWVgIGlmIHRoaXMgbWV0YWRhdGEgaXMgZm9yIGEgZGlyZWN0b3J5LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IGlzRGlyOiBib29sZWFuO1xuXHRcdFxuXHRcdC8qKlxuXHRcdCAqIGB0cnVlYCBpZiB0aGlzIG1ldGFkYXRhIGlzIGZvciBhIHJlZ3VsYXIgZmlsZS5cblx0XHQgKi9cblx0XHRyZWFkb25seSBpc0ZpbGU6IGJvb2xlYW47XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogYHRydWVgIGlmIHRoaXMgbWV0YWRhdGEgaXMgZm9yIGEgc3ltYm9saWMgbGluay5cblx0XHQgKi9cblx0XHRyZWFkb25seSBpc1N5bWxpbms6IGJvb2xlYW47XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogVGhlIHNpemUgb2YgdGhlIGZpbGUsIGluIGJ5dGVzLCB0aGlzIG1ldGFkYXRhIGlzIGZvci5cblx0XHQgKi9cblx0XHRyZWFkb25seSBzaXplOiBudW1iZXI7XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogVGhlIHBlcm1pc3Npb25zIG9mIHRoZSBmaWxlIHRoaXMgbWV0YWRhdGEgaXMgZm9yLlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IHBlcm1pc3Npb25zOiBQZXJtaXNzaW9ucztcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgSUQgb2YgdGhlIGRldmljZSBjb250YWluaW5nIHRoZSBmaWxlLiBPbmx5IGF2YWlsYWJsZSBvbiBVbml4LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IGRldj86IG51bWJlcjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgaW5vZGUgbnVtYmVyLiBPbmx5IGF2YWlsYWJsZSBvbiBVbml4LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IGlubz86IG51bWJlcjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgcmlnaHRzIGFwcGxpZWQgdG8gdGhpcyBmaWxlLiBPbmx5IGF2YWlsYWJsZSBvbiBVbml4LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IG1vZGU/OiBudW1iZXI7XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogVGhlIG51bWJlciBvZiBoYXJkIGxpbmtzIHBvaW50aW5nIHRvIHRoaXMgZmlsZS4gT25seSBhdmFpbGFibGUgb24gVW5peC5cblx0XHQgKi9cblx0XHRyZWFkb25seSBubGluaz86IG51bWJlcjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgdXNlciBJRCBvZiB0aGUgb3duZXIgb2YgdGhpcyBmaWxlLiBPbmx5IGF2YWlsYWJsZSBvbiBVbml4LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IHVpZD86IG51bWJlcjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgZ3JvdXAgSUQgb2YgdGhlIG93bmVyIG9mIHRoaXMgZmlsZS4gT25seSBhdmFpbGFibGUgb24gVW5peC5cblx0XHQgKi9cblx0XHRyZWFkb25seSBnaWQ/OiBudW1iZXI7XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogVGhlIGRldmljZSBJRCBvZiB0aGlzIGZpbGUgKGlmIGl0IGlzIGEgc3BlY2lhbCBvbmUpLiBPbmx5IGF2YWlsYWJsZSBvbiBVbml4LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IHJkZXY/OiBudW1iZXI7XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogVGhlIGJsb2NrIHNpemUgZm9yIGZpbGVzeXN0ZW0gSS9PLiBPbmx5IGF2YWlsYWJsZSBvbiBVbml4LlxuXHRcdCAqL1xuXHRcdHJlYWRvbmx5IGJsa3NpemU/OiBudW1iZXI7XG5cdFx0XG5cdFx0LyoqXG5cdFx0ICogVGhlIG51bWJlciBvZiBibG9ja3MgYWxsb2NhdGVkIHRvIHRoZSBmaWxlLCBpbiA1MTItYnl0ZSB1bml0cy4gT25seSBhdmFpbGFibGUgb24gVW5peC5cblx0XHQgKi9cblx0XHRyZWFkb25seSBibG9ja3M/OiBudW1iZXI7XG5cdH1cblx0XG5cdC8qKiAqL1xuXHRleHBvcnQgaW50ZXJmYWNlIFBlcm1pc3Npb25zXG5cdHtcblx0XHQvKipcblx0XHQgKiBgdHJ1ZWAgaWYgdGhlc2UgcGVybWlzc2lvbnMgZGVzY3JpYmUgYSByZWFkb25seSAodW53cml0YWJsZSkgZmlsZS5cblx0XHQgKi9cblx0XHRyZWFkb25seTogYm9vbGVhbjtcblx0XHRcblx0XHQvKipcblx0XHQgKiBUaGUgdW5kZXJseWluZyByYXcgYHN0X21vZGVgIGJpdHMgdGhhdCBjb250YWluIHRoZSBzdGFuZGFyZCBVbml4XG5cdFx0ICogcGVybWlzc2lvbnMgZm9yIHRoaXMgZmlsZS5cblx0XHQgKi9cblx0XHRtb2RlPzogbnVtYmVyO1xuXHR9XG5cdFxuXHRkZWNsYXJlIGNvbnN0IG1vZHVsZTogYW55O1xuXHR0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiICYmIE9iamVjdC5hc3NpZ24obW9kdWxlLmV4cG9ydHMsIHsgRmlsYVRhdXJpIH0pO1xufSJdfQ==